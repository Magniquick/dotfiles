#!/usr/bin/env bash
set -euo pipefail

# Minimal helper to show/hide the powermenu while respecting its revealer delay.
# Usage: manage (show|hide|toggle) [powermenu]

eww_cmd="${EWW:-eww}"
cmd="${1:-}"
widget="${2:-powermenu}"

# Only the powermenu is supported in this trimmed-down setup.
if [[ "${widget}" != "powermenu" ]]; then
  echo "Unsupported widget: ${widget}" >&2
  exit 1
fi

delay="0.3"

show() {
  # Open on primary monitor and mark visible
  "${eww_cmd}" open-many "${widget}" --arg "${widget}:is-secondary=false" >/dev/null
  "${eww_cmd}" update "${widget}-visible"=true
}

hide() {
  # Clear selection and wait for the revealer before closing
  "${eww_cmd}" update "${widget}-visible"=false powermenu-button-selected= powermenu-button-hover=
  sleep "${delay}"
  "${eww_cmd}" close "${widget}" >/dev/null
}

toggle() {
  current="$("${eww_cmd}" get "${widget}-visible" 2>/dev/null || echo false)"
  if [[ "${current}" == "true" ]]; then
    hide
  else
    show
  fi
}

case "${cmd}" in
  show|hide|toggle)
    "${cmd}"
    ;;
  *)
    echo "Usage: $(basename "$0") [show|hide|toggle] [powermenu]" >&2
    exit 1
    ;;
esac
